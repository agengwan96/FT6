<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Individual Interaction</title>
    <script
      src="https://kit.fontawesome.com/c8e4d183c2.js"
      crossorigin="anonymous"
    ></script>
    <script src="../scripts/app.js" defer></script>
    <script type="module" src="../scripts/firebase_scripts.js" defer></script>
    <link rel="stylesheet" type="text/css" href="../style.css" />  </head>
  <body>
    <nav>
      <div class="nav__container">
        <h1 class="logo red">MU<span class="world">WORLD</span></h1>
        <ul class="nav__link--list">
          <li class="nav__link">
            <a href="./dashboard.html" class="nav__link--anchor">Dashboard</a>
          <li class="nav__link">
            <a href="./heatmap.html" class="nav__link--anchor">Heatmap</a>
          </li>
          </li>
          <li class="nav__link">
            <a href="./org_interaction.html" class="nav__link--anchor">Org. Interaction</a>
          </li>
          <li class="nav__link">
            <a href="./mou.html" class="nav__link--anchor">MOU</a>
          </li>
        </ul>
        <button class="logout" id="logoutButton">LogOut</button>
      </div>
    </nav>
    <section id="ind_interaction">
      <h1 class="sub__title"><span class="red">I</span>ndividual Interaction</h1>
    </section>
    <section id="indSubmissionForm">
      <h2>Submit details here</h2>
      <form id="indIntForm">
        <h3>Staff details</h3>
        <label for="staffName">Name</label>
        <input type="text" placeholder="Name" id="staffName"/>
        <label for="staffRole">Role</label>
        <input type="text" placeholder="Role" id="staffRole"/>
        <label for="staffDepartment">Department</label>
        <input type="text" placeholder="Department" id="staffDepartment"/>
        <label for="staffContact">Contact details</label>
        <input type="text" placeholder="Contact details" id="staffContact"/>
        <h3>Interaction details</h3>
        <label for="visitDate">Date of visit</label>
        <input type="date" placeholder="Visit date" id="visitDate"/>
        <label for="visitPurpose">Purpose of visit</label>
        <input type="text" placeholder="Purpose of visit" id="visitPurpose"/>
        <label for="visitStatus">Completion status</label>
        <select name="visitStatus" id="visitStatus">
          <option value="scheduled">Scheduled</option>
          <option value="completed">Completed</option>
          <option value="cancelled">Cancelled</option>
        </select>
        <h3>Organisation Details</h3>
        <label for="orgName">Name</label>
        <input type="text" placeholder="Name" id="orgName"/>
        <label for="orgAddress">Address</label>
        <input type="text" placeholder="Address" id="orgAddress"/>
        <label for="orgType">Organisation type</label>
        <input type="text" placeholder="Organisation type" id="orgType"/>
        <input type="submit" value="Submit" id="indIntSubmit"/>
      </form>
      
    </section>
    <footer>
      <p class="footer__text">MuWorld Copyright &#169; 2023</p>
    </footer>
  </body>
</html>

<script type="module">
  import { initializeApp } from 'firebase/app';
  import { getFirestore, collection, addDoc } from 'firebase/firestore';

  const firebaseConfig = {
    // Replace with your actual Firebase project configuration
    apiKey: 'AIzaSyBw1ySW4GfUqEeRtpBTYgCGeMSLC3ru4QU',
    authDomain: "muworldv1-ft6.firebaseapp.com",
    databaseURL: "https://muworldv1-ft6-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "muworldv1-ft6",
    storageBucket: "muworldv1-ft6.appspot.com",
    messagingSenderId: "659133217389",
    appId: "1:659133217389:web:386e36e80f023670421d64",
    measurementId: "G-BQJCVKPBJN"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const database = getDatabase();

  // Form submission handler
  const form = document.getElementById('interaction-form');
  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    // Validate form fields
    if (!validateForm()) {
      alert('Please fill in all required fields correctly.');
      return;
    }

    // Get form data
    const formData = new FormData(form);
    const interactionData = {
      staffId: formData.get('staffId'),
      staffName: formData.get('staffName'),
      staffRole: formData.get('staffRole'),
      staffDepartment: formData.get('staffDepartment'),
      staffContactDetail: formData.get('staffContactDetail'),
      visitDate: formData.get('visitDate'),
      completionStatus: formData.get('completionStatus'),
      organisationId: formData.get('organisationId'),
      organisationName: formData.get('organisationName'),
      organisationAddress: formData.get('organisationAddress'),
      organisationType: formData.get('organisationType')
    };

    try {
      // Add interaction data to Firebase
      const interactionRef = collection(db, 'interactions');
      await addDoc(interactionRef, interactionData);
      alert('Interaction data successfully submitted.');
      form.reset();
    } catch (error) {
      console.error('Error adding document: ', error);
      alert('Error submitting interaction data. Please try again.');
    }
  });

  // Validate form fields
  function validateForm() {
    const staffId = document.getElementById('staffId').value;
    const staffName = document.getElementById('staffName').value;
    const staffRole = document.getElementById('staffRole').value;
    const staffDepartment = document.getElementById('staffDepartment').value;
    const staffContactDetail = document.getElementById('staffContactDetail').value;
    const visitDate = document.getElementById('visitDate').value;
    const completionStatus = document.getElementById('completionStatus').value;
    const organisationName = document.getElementById('organisationName').value;
    const organisationAddress = document.getElementById('organisationAddress').value;
    const organisationType = document.getElementById('organisationType').value;

    if (!staffId || !staffName || !staffRole || !staffDepartment || !staffContactDetail || !visitDate || !completionStatus || !organisationName || !organisationAddress || !organisationType) {
      return false;
    }

    if (!validateDate(visitDate)) {
      alert('Invalid date format. Please use the format YYYY-MM-DD.');
      return false;
    }

    if (!validateEmail(staffContactDetail)) {
      alert('Invalid email address.');
      return false;
    }

    return true;
  }

  // Validate date format (YYYY-MM-DD)
  function validateDate(date) {
    const regex = /^\d{4}-\d{2}-\d{2}$/;
    return regex.test(date);
  }

  // Validate email format
  function validateEmail(email) {
    const regex = /^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/;
    return regex.test(email);
  }

</script>